---
title: "Motor Vehicle Accidents in Victoria"
author:
- familyname: "Al-Hindi"
  othernames: "Ibrahim"
  address: Monash University
  email: "imalh2@student.monash.edu"
  correspondingauthor: true
  qualifications:  "Master of Business Analytics"
- familyname: "Chouzadjian"
  othernames: "Arek"
  address: Monash University
  email: "acho0007@student.monash.edu"
  correspondingauthor: true
  qualifications: "Master of Business Analytics"
- familyname: "Chen"
  othernames: "Kaihao"
  address: Monash University
  email: "kche154@student.monash.edu"
  correspondingauthor: true
  qualifications: "Master of Business Analytics"
department: "Department of Econometrics and Business Statistics"
organization: VicRoads
bibliography: references.bib
biblio-style: authoryear-comp
linestretch: 1.5
output:
  bookdown::pdf_document2:
    template: monashreport2.tex
    fig_caption: yes
    fig_height: 5
    fig_width: 8
    includes:
      in_header: preamble.tex
    keep_tex: yes
    number_sections: yes
    citation_package: biblatex
    toc: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      eval = TRUE,
                      message = FALSE, 
                      warning = FALSE,
                      fig.width=6,
                      fig.height=4)
```

```{r libraries}
library(tidyverse)
library(lubridate)
library(janitor)
library(knitr)
library(kableExtra)
library(bookdown)
library(ggmap)
library(ggthemes)
```

```{r load-data}
accidents <- read_csv("data/ACCIDENT.csv") %>%
  clean_names()

locations <- read_csv("data/ACCIDENT_LOCATION.csv") %>%
  clean_names()

nodes <- read_csv("data/NODE.csv") %>%
  clean_names()

persons <- read_csv("data/PERSON.csv") %>%
  clean_names()

vehicles <- read_csv("data/VEHICLE.csv") %>%
  clean_names()
```

```{r create-year-hour-day}
accidents <- accidents %>%
  mutate(accidentdate = dmy(accidentdate),
         Year = year(accidentdate),
         Hour = hour(accidenttime),
         Weekday = wday(accidentdate, 
                        label = TRUE,
                        abbr = FALSE))
```

\section*{Accidents by Locations, Gender and Road User Type}

\subsection*{Accidents Map}

```{r accidents-map, fig.cap="Map of accident locations in Victoria"}
location_box <- c(min(nodes$long), 
                  min(nodes$lat), 
                  max(nodes$long), 
                  max(nodes$lat))

location_map <- get_map(location = location_box, 
                        source = 'osm')

  ggmap(location_map) + 
    geom_point(data = nodes,
               aes(x = long, 
                   y = lat), 
               colour="#0072B2", 
               alpha=0.5, 
               size = 0.05) +
    theme_map()
```

As shown in figure \@ref(fig:accidents-map), accidents are most highly concentrated around metropolitan Melbourne, and gradually reduce in volume the further we move from Melbourne, with pockets of concentrations in the regional cities such as Bendigo, Ballarat and Geelong. This is due to the population being most present in metropolitan Melbourne, resulting in more accidents, and the population declining as we drift away, resulting in less accidents.


\subsection*{Roads with Most Accidents and Highest Death Rates}

```{r join-road-names}
roads_accidents <- accidents %>%
  left_join(locations) %>% 
  mutate(Road = paste(road_name, road_type))
```


```{r accidents-by-road}
accidents_per_road <- roads_accidents %>%
  count(Road, 
        name = "Accidents"
        ,sort = T)

deaths_per_road <- roads_accidents %>%
  group_by(Road) %>%
  tally(no_persons_killed,
        name = "Deaths",
        sort = TRUE)

accidents_per_road %>% 
  head(8) %>% 
  kable(caption = "Accidents by road") %>% 
  kable_styling(bootstrap_options = "striped")
```

```{r deadliest-road}
deadliest_road <- accidents_per_road %>%
  left_join(deaths_per_road) %>%
  filter(Accidents >= 100) %>%
  mutate(Deaths_per_accident = Deaths/Accidents) %>%
  arrange(desc(Deaths_per_accident))

deadliest_road %>% 
  head(8) %>% 
  kable(caption = "Deadliest roads") %>% 
  kable_styling(bootstrap_options = "striped")
```

According to table \@ref(tab:accidents-by-road), **Princes Highway**, **High Street** and **Nepean Highway** are the three most accident prone roads in Victoria with `r accidents_per_road[1,2]`, `r accidents_per_road[2,2]`, `r accidents_per_road[3,2]` accidents respectively. It is important to note that roads names "High Street" are very common and are present in various suburbs in Victoria, therefore the "High Street" displayed in the table is likely a combination of all the accidents that occurred in all the High Streets. When examining the deadliest roads from table \@ref(tab:deadliest-road), it is immediately apparent that **Highways** are the deadliest type of road in Victoria, this is likely a result of highways being locations of higher speed zones, which as we have seen from the previous section, lead to higher death rates.

\subsection*{Accidents by Gender}

```{r accidents-gender-table}
persons <- persons %>%
  mutate(sex = recode(sex,
                      "F" = "Female",
                      "M" = "Male",
                      "U" = "Unknown"))
  
  
persons %>% 
  filter(road_user_type_desc == "Drivers",
         !is.na(sex)) %>% 
  count(sex,
        name = "Accidents",
        sort = TRUE) %>% 
  kable(caption = "Number of accidents by gender") %>% 
  kable_styling(bootstrap_options = "striped")
```

```{r accidents-gender-plot, fig.cap="Number of accidents by gender and age"}
persons %>% 
  filter(road_user_type_desc == "Drivers",
         sex %in% c("Female",
                    "Male"),
         age > 15) %>% 
  count(age,
        sex,
        name = "Accidents") %>% 
  
  ggplot(aes(x = age,
             y = Accidents, 
             color = sex)) +
  geom_line() +
  xlab("Age")
```

Table \@ref(tab:accidents-gender-table) shows that there are more accidents committed by males (171,043) than by females (118,307). Figure \@ref(fig:accidents-gender-plot) reflects that by showing that males commit more accidents than females at all age groups. This could be a result of males being more present on the road than females, for example the majority of truck drivers and taxi/uber drivers are male, therefore representing higher numbers and longer times spent on the road. What is common between both genders, though, is that the accident numbers for are highest as young and inexperienced drivers before steadily declining due to age and experience. This is consistent with the findings from @gislason1997medical.


\subsection*{User Type Death Rate}

```{r user-death-rate, fig.cap="Death rate by road user type"}
user_type <- persons %>% 
  count(road_user_type_desc, 
        name = "User")

user_type_fatal <- persons %>% 
  filter(inj_level_desc == "Fatality") %>% 
  count(road_user_type_desc, 
        name = "Fatal")

user_type %>% 
  left_join(user_type_fatal) %>% 
  mutate(death_rate = Fatal / User) %>% 
  
  ggplot(aes(x = fct_reorder(road_user_type_desc, 
                             death_rate), 
             y = death_rate)) +
  geom_col(fill = "#999999") +
  labs(x = "User Type",
       y = "Death Rate") +
  theme(axis.text.x = element_text(angle = 45,
                                   hjust = 1))
  
```

As per figure \@ref(fig:user-death-rate), **pedestrians** are at the most risk of death per accident, this is expected as pedestrians have no protection at all. **Motorcyclists** and **pillion passengers** (motorcycle passengers) occupy the second and third highest death rate per accident. It is surprising, however, that **bicyclists**'s death rate is similar to car drivers and passengers, as one would expect that bicyclists would have a death rate similar to that of pedestrians or motorcyclists, due to the lack of protection besides a helmet.





















